<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sudoku Generator – losowe plansze</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 650px;
    margin: auto;
    text-align: center;
  }
  label, select, input {
    font-size: 16px;
    margin: 5px;
  }
  button {
    font-size: 16px;
    padding: 8px 14px;
    margin: 10px 6px 10px 6px;
    cursor: pointer;
  }
  #canvas {
    border: 3px solid black;
    margin-top: 20px;
  }
</style>
</head>
<body>

<h1>Sudoku 6x6 i 9x9 – Losowy Generator</h1>

<div>
  <label for="size">Rozmiar:</label>
  <select id="size">
    <option value="6">6 x 6</option>
    <option value="9" selected>9 x 9</option>
  </select>

  <label for="difficulty">Poziom:</label>
  <select id="difficulty">
    <option value="easy" selected>Easy</option>
    <option value="medium">Medium</option>
  </select>
</div>

<div>
  <input type="text" id="puzzleName" placeholder="Easy 6x6 No. 1" style="width: 180px; margin-top:10px;" />
</div>

<div>
  <button id="generateBtn">Generuj planszę</button>
  <button id="showAnswerBtn">Pokaż rozwiązanie</button>
  <button id="copyBtn">Kopiuj obraz do schowka</button>
</div>

<canvas id="canvas" width="400" height="440"></canvas>

<script>
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function generateFullBoard(size) {
  const board = Array.from({ length: size }, () => Array(size).fill(''));
  const isSafe = (r, c, n) => {
    for (let i = 0; i < size; i++) {
      if (board[r][i] == n || board[i][c] == n) return false;
    }
    const blockSize = size === 9 ? 3 : 2;
    const startRow = r - (r % blockSize);
    const startCol = c - (c % blockSize);
    for (let i = 0; i < blockSize; i++) {
      for (let j = 0; j < blockSize; j++) {
        if (board[startRow + i][startCol + j] == n) return false;
      }
    }
    return true;
  };

  const fill = (r, c) => {
    if (r === size) return true;
    const [nextR, nextC] = c === size - 1 ? [r + 1, 0] : [r, c + 1];
    const numbers = shuffle([...Array(size).keys()].map(x => (x + 1).toString()));
    for (let num of numbers) {
      if (isSafe(r, c, num)) {
        board[r][c] = num;
        if (fill(nextR, nextC)) return true;
        board[r][c] = '';
      }
    }
    return false;
  };

  fill(0, 0);
  return board;
}

function hideCells(board, difficulty) {
  const size = board.length;
  const attempts = difficulty === 'easy' ? size * 2.5 : size * 4;
  const puzzle = board.map(row => row.slice());
  let hidden = 0;
  while (hidden < attempts) {
    const r = Math.floor(Math.random() * size);
    const c = Math.floor(Math.random() * size);
    if (puzzle[r][c] !== '') {
      puzzle[r][c] = '';
      hidden++;
    }
  }
  return puzzle;
}

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let currentBoard = null;
let currentSolution = null;
let currentSize = 9;
let currentDifficulty = 'easy';

function drawSudoku(name, board, solution, size, showSolution = false) {
  const cellSize = size === 9 ? 40 : 50;
  const offsetX = 20;
  const offsetY = 80;
  canvas.width = offsetX * 2 + cellSize * size;
  canvas.height = offsetY + cellSize * size + 60;

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.font = "bold 20px Arial";
  ctx.fillStyle = "black";
  ctx.textAlign = "left";
  ctx.fillText(name, offsetX, 40);

  ctx.fillStyle = "white";
  ctx.fillRect(offsetX, offsetY, cellSize*size, cellSize*size);

  const blockRowSize = size === 9 ? 3 : 2;
  const blockColSize = size === 9 ? 3 : 3;

  for(let r=0; r <= size; r++) {
    ctx.lineWidth = (r % blockRowSize === 0) ? 3 : 1;
    ctx.beginPath();
    ctx.moveTo(offsetX, offsetY + r*cellSize);
    ctx.lineTo(offsetX + cellSize*size, offsetY + r*cellSize);
    ctx.stroke();
  }
  for(let c=0; c <= size; c++) {
    ctx.lineWidth = (c % blockColSize === 0) ? 3 : 1;
    ctx.beginPath();
    ctx.moveTo(offsetX + c*cellSize, offsetY);
    ctx.lineTo(offsetX + c*cellSize, offsetY + cellSize*size);
    ctx.stroke();
  }

  ctx.font = size === 9 ? "bold 24px Arial" : "bold 28px Arial";
  ctx.fillStyle = "black";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";

  for(let r=0; r < size; r++) {
    for(let c=0; c < size; c++) {
      let val = showSolution ? solution[r][c] : board[r][c];
      if(val !== '') {
        ctx.fillText(val, offsetX + c*cellSize + cellSize/2, offsetY + r*cellSize + cellSize/2);
      }
    }
  }

  if(showSolution) {
    ctx.font = "italic 16px Arial";
    ctx.textAlign = "center";
    ctx.fillText("Rozwiązanie", offsetX + cellSize*size/2, offsetY + cellSize*size + 30);
  }
}

function generatePuzzle() {
  const size = parseInt(document.getElementById('size').value);
  const difficulty = document.getElementById('difficulty').value;
  const puzzleNameInput = document.getElementById('puzzleName');
  let puzzleName = puzzleNameInput.value.trim();
  if(!puzzleName) {
    puzzleName = `${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)} ${size}x${size}`;
    puzzleNameInput.value = puzzleName;
  }
  currentSize = size;
  currentDifficulty = difficulty;
  currentSolution = generateFullBoard(size);
  currentBoard = hideCells(currentSolution, difficulty);
  drawSudoku(puzzleName, currentBoard, currentSolution, size, false);
}

function showAnswer() {
  if(!currentSolution) return;
  const puzzleName = document.getElementById('puzzleName').value.trim();
  drawSudoku(puzzleName, currentBoard, currentSolution, currentSize, true);
}

async function copyCanvasImage() {
  try {
    canvas.toBlob(async (blob) => {
      await navigator.clipboard.write([
        new ClipboardItem({'image/png': blob})
      ]);
      alert('Obraz Sudoku skopiowany do schowka! Możesz wkleić go np. do Canvy.');
    });
  } catch(e) {
    alert('Twoja przeglądarka nie wspiera kopiowania obrazów do schowka.');
  }
}

document.getElementById('generateBtn').addEventListener('click', generatePuzzle);
document.getElementById('showAnswerBtn').addEventListener('click', showAnswer);
document.getElementById('copyBtn').addEventListener('click', copyCanvasImage);

generatePuzzle();
</script>
</body>
</html>
